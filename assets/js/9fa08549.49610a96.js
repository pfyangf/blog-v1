"use strict";(globalThis.webpackChunkblog_v1=globalThis.webpackChunkblog_v1||[]).push([[7997],{7976(n,e,i){i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var l=i(3221),r=i(4848),t=i(8453);const s={slug:"defi-flash-loan-attacks",title:"DeFi\u95ea\u7535\u8d37\u653b\u51fb\u6df1\u5ea6\u5256\u6790\uff1a\u539f\u7406\u3001\u6848\u4f8b\u4e0e\u9632\u5fa1",authors:["autosec"],tags:["DeFi\u5b89\u5168","\u95ea\u7535\u8d37","\u4ef7\u683c\u64cd\u7eb5","\u5957\u5229\u653b\u51fb","\u533a\u5757\u94fe\u5b89\u5168"]},a="DeFi\u95ea\u7535\u8d37\u653b\u51fb\u6df1\u5ea6\u5256\u6790\uff1a\u539f\u7406\u3001\u6848\u4f8b\u4e0e\u9632\u5fa1",c={authorsImageUrls:[void 0]},d=[{value:"\u95ea\u7535\u8d37\u57fa\u7840",id:"\u95ea\u7535\u8d37\u57fa\u7840",level:2},{value:"\u4ec0\u4e48\u662f\u95ea\u7535\u8d37\uff1f",id:"\u4ec0\u4e48\u662f\u95ea\u7535\u8d37",level:3},{value:"\u5e38\u89c1\u653b\u51fb\u6a21\u5f0f",id:"\u5e38\u89c1\u653b\u51fb\u6a21\u5f0f",level:2},{value:"1. \u4ef7\u683c\u64cd\u7eb5\u653b\u51fb",id:"1-\u4ef7\u683c\u64cd\u7eb5\u653b\u51fb",level:3},{value:"2. \u6cbb\u7406\u653b\u51fb",id:"2-\u6cbb\u7406\u653b\u51fb",level:3},{value:"3. \u9884\u8a00\u673a\u64cd\u7eb5",id:"3-\u9884\u8a00\u673a\u64cd\u7eb5",level:3},{value:"\u91cd\u5927\u653b\u51fb\u6848\u4f8b",id:"\u91cd\u5927\u653b\u51fb\u6848\u4f8b",level:2},{value:"bZx \u653b\u51fb\uff082020\u5e742\u6708\uff09",id:"bzx-\u653b\u51fb2020\u5e742\u6708",level:3},{value:"PancakeBunny \u653b\u51fb\uff082021\u5e745\u6708\uff09",id:"pancakebunny-\u653b\u51fb2021\u5e745\u6708",level:3},{value:"Cream Finance \u653b\u51fb\uff082021\u5e7410\u6708\uff09",id:"cream-finance-\u653b\u51fb2021\u5e7410\u6708",level:3},{value:"\u9632\u5fa1\u7b56\u7565",id:"\u9632\u5fa1\u7b56\u7565",level:2},{value:"1. \u4f7f\u7528\u65f6\u95f4\u52a0\u6743\u5e73\u5747\u4ef7\u683c\uff08TWAP\uff09",id:"1-\u4f7f\u7528\u65f6\u95f4\u52a0\u6743\u5e73\u5747\u4ef7\u683ctwap",level:3},{value:"2. \u4f7f\u7528\u591a\u4e2a\u4ef7\u683c\u6e90",id:"2-\u4f7f\u7528\u591a\u4e2a\u4ef7\u683c\u6e90",level:3},{value:"3. \u5b9e\u65bd\u4ea4\u6613\u9650\u5236",id:"3-\u5b9e\u65bd\u4ea4\u6613\u9650\u5236",level:3},{value:"4. \u6d41\u52a8\u6027\u68c0\u67e5",id:"4-\u6d41\u52a8\u6027\u68c0\u67e5",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u534f\u8bae\u8bbe\u8ba1\u5c42\u9762",id:"\u534f\u8bae\u8bbe\u8ba1\u5c42\u9762",level:3},{value:"\u4ee3\u7801\u5b9e\u73b0\u5c42\u9762",id:"\u4ee3\u7801\u5b9e\u73b0\u5c42\u9762",level:3},{value:"\u76d1\u63a7\u4e0e\u54cd\u5e94",id:"\u76d1\u63a7\u4e0e\u54cd\u5e94",level:2},{value:"\u5b9e\u65f6\u76d1\u63a7\u6307\u6807",id:"\u5b9e\u65f6\u76d1\u63a7\u6307\u6807",level:3},{value:"\u5e94\u6025\u54cd\u5e94\u673a\u5236",id:"\u5e94\u6025\u54cd\u5e94\u673a\u5236",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function o(n){const e={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"\u95ea\u7535\u8d37\uff08Flash Loan\uff09\u662f DeFi \u9886\u57df\u7684\u521b\u65b0\u91d1\u878d\u5de5\u5177\uff0c\u4f46\u540c\u65f6\u4e5f\u6210\u4e3a\u4e86\u653b\u51fb\u8005\u6700\u559c\u7231\u7684\u6b66\u5668\u30022020-2023\u5e74\u95f4\uff0c\u57fa\u4e8e\u95ea\u7535\u8d37\u7684\u653b\u51fb\u9020\u6210\u4e86\u8d85\u8fc7 10 \u4ebf\u7f8e\u5143\u7684\u635f\u5931\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u95ea\u7535\u8d37\u57fa\u7840",children:"\u95ea\u7535\u8d37\u57fa\u7840"}),"\n",(0,r.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u95ea\u7535\u8d37",children:"\u4ec0\u4e48\u662f\u95ea\u7535\u8d37\uff1f"}),"\n",(0,r.jsx)(e.p,{children:"\u95ea\u7535\u8d37\u662f\u4e00\u79cd\u65e0\u9700\u62b5\u62bc\u7684\u8d37\u6b3e\uff0c\u4f46\u5fc5\u987b\u5728\u540c\u4e00\u7b14\u4ea4\u6613\u4e2d\u501f\u5165\u548c\u5f52\u8fd8\u3002\u5982\u679c\u65e0\u6cd5\u5f52\u8fd8\uff0c\u6574\u4e2a\u4ea4\u6613\u4f1a\u56de\u6eda\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'// Aave \u95ea\u7535\u8d37\u793a\u4f8b\ninterface IFlashLoanReceiver {\n    function executeOperation(\n        address[] calldata assets,\n        uint256[] calldata amounts,\n        uint256[] calldata premiums,\n        address initiator,\n        bytes calldata params\n    ) external returns (bool);\n}\n\ncontract FlashLoanExample is IFlashLoanReceiver {\n    ILendingPool public lendingPool;\n    \n    function executeFlashLoan(address asset, uint256 amount) public {\n        address[] memory assets = new address[](1);\n        assets[0] = asset;\n        \n        uint256[] memory amounts = new uint256[](1);\n        amounts[0] = amount;\n        \n        uint256[] memory modes = new uint256[](1);\n        modes[0] = 0; // \u65e0\u503a\u52a1\u6a21\u5f0f\n        \n        lendingPool.flashLoan(\n            address(this),\n            assets,\n            amounts,\n            modes,\n            address(this),\n            "",\n            0\n        );\n    }\n    \n    function executeOperation(\n        address[] calldata assets,\n        uint256[] calldata amounts,\n        uint256[] calldata premiums,\n        address initiator,\n        bytes calldata params\n    ) external override returns (bool) {\n        // \u5728\u8fd9\u91cc\u6267\u884c\u5957\u5229\u6216\u653b\u51fb\u903b\u8f91\n        \n        // \u5fc5\u987b\u5f52\u8fd8\u8d37\u6b3e + \u624b\u7eed\u8d39\n        uint256 amountOwing = amounts[0] + premiums[0];\n        IERC20(assets[0]).approve(address(lendingPool), amountOwing);\n        \n        return true;\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u5e38\u89c1\u653b\u51fb\u6a21\u5f0f",children:"\u5e38\u89c1\u653b\u51fb\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4ef7\u683c\u64cd\u7eb5\u653b\u51fb",children:"1. \u4ef7\u683c\u64cd\u7eb5\u653b\u51fb"}),"\n",(0,r.jsx)(e.p,{children:"\u653b\u51fb\u8005\u5229\u7528\u95ea\u7535\u8d37\u64cd\u7eb5 DEX \u4ef7\u683c\uff0c\u7136\u540e\u5728\u5176\u4ed6\u5e73\u53f0\u5957\u5229\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u653b\u51fb\u6d41\u7a0b\uff1a"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u501f\u5165\u5927\u91cf\u4ee3\u5e01 A"}),"\n",(0,r.jsx)(e.li,{children:"\u5728 DEX1 \u5927\u91cf\u4e70\u5165\u4ee3\u5e01 B\uff0c\u63a8\u9ad8\u4ef7\u683c"}),"\n",(0,r.jsx)(e.li,{children:"\u5728\u4f7f\u7528 DEX1 \u4ef7\u683c\u7684\u534f\u8bae\u4e2d\uff0c\u7528\u9ad8\u4ef7\u7684 B \u4f5c\u4e3a\u62b5\u62bc\u501f\u51fa\u4ee3\u5e01 C"}),"\n",(0,r.jsx)(e.li,{children:"\u5728 DEX2 \u4ee5\u6b63\u5e38\u4ef7\u683c\u5356\u51fa B"}),"\n",(0,r.jsx)(e.li,{children:"\u5f52\u8fd8\u95ea\u7535\u8d37\uff0c\u83b7\u5229"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"2-\u6cbb\u7406\u653b\u51fb",children:"2. \u6cbb\u7406\u653b\u51fb"}),"\n",(0,r.jsx)(e.p,{children:"\u5229\u7528\u95ea\u7535\u8d37\u4e34\u65f6\u83b7\u5f97\u5927\u91cf\u6cbb\u7406\u4ee3\u5e01\uff0c\u64cd\u7eb5\u6295\u7968\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:"// \u6cbb\u7406\u653b\u51fb\u793a\u4f8b\ncontract GovernanceAttack {\n    function attack() external {\n        // 1. \u95ea\u7535\u8d37\u501f\u5165\u6cbb\u7406\u4ee3\u5e01\n        flashLoan(governanceToken, largeAmount);\n        \n        // 2. \u5728 executeOperation \u4e2d\uff1a\n        //    - \u8d28\u62bc\u4ee3\u5e01\u83b7\u5f97\u6295\u7968\u6743\n        //    - \u53d1\u8d77\u6076\u610f\u63d0\u6848\u5e76\u7acb\u5373\u6295\u7968\n        //    - \u6267\u884c\u63d0\u6848\n        //    - \u53d6\u6d88\u8d28\u62bc\n        \n        // 3. \u5f52\u8fd8\u95ea\u7535\u8d37\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u9884\u8a00\u673a\u64cd\u7eb5",children:"3. \u9884\u8a00\u673a\u64cd\u7eb5"}),"\n",(0,r.jsx)(e.p,{children:"\u653b\u51fb\u4f9d\u8d56\u5355\u4e00 DEX \u4ef7\u683c\u7684\u9884\u8a00\u673a\u7cfb\u7edf\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u91cd\u5927\u653b\u51fb\u6848\u4f8b",children:"\u91cd\u5927\u653b\u51fb\u6848\u4f8b"}),"\n",(0,r.jsx)(e.h3,{id:"bzx-\u653b\u51fb2020\u5e742\u6708",children:"bZx \u653b\u51fb\uff082020\u5e742\u6708\uff09"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u635f\u5931"}),"\uff1a100 \u4e07\u7f8e\u5143"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u653b\u51fb\u6b65\u9aa4\uff1a"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u4ece dYdX \u501f\u5165 10,000 ETH \u95ea\u7535\u8d37"}),"\n",(0,r.jsx)(e.li,{children:"\u5728 Compound \u5b58\u5165 5,500 ETH"}),"\n",(0,r.jsx)(e.li,{children:"\u7528\u5269\u4f59 ETH \u5728 bZx \u5f00 5 \u500d\u6760\u6746\u505a\u7a7a WBTC"}),"\n",(0,r.jsx)(e.li,{children:"bZx \u5728 Uniswap \u4e70\u5165\u5927\u91cf WBTC\uff0c\u63a8\u9ad8\u4ef7\u683c"}),"\n",(0,r.jsx)(e.li,{children:"\u5728 Uniswap \u4ee5\u9ad8\u4ef7\u5356\u51fa WBTC"}),"\n",(0,r.jsx)(e.li,{children:"\u5f52\u8fd8\u95ea\u7535\u8d37\uff0c\u83b7\u5229 35 \u4e07\u7f8e\u5143"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"pancakebunny-\u653b\u51fb2021\u5e745\u6708",children:"PancakeBunny \u653b\u51fb\uff082021\u5e745\u6708\uff09"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u635f\u5931"}),"\uff1a4500 \u4e07\u7f8e\u5143"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u653b\u51fb\u539f\u7406\uff1a"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5229\u7528\u95ea\u7535\u8d37\u64cd\u7eb5 BUNNY/BNB \u4ef7\u683c"}),"\n",(0,r.jsx)(e.li,{children:"\u89e6\u53d1\u534f\u8bae\u7684\u94f8\u5e01\u673a\u5236"}),"\n",(0,r.jsx)(e.li,{children:"\u5927\u91cf\u94f8\u9020 BUNNY \u4ee3\u5e01\u5e76\u629b\u552e"}),"\n",(0,r.jsx)(e.li,{children:"BUNNY \u4ef7\u683c\u66b4\u8dcc 96%"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"cream-finance-\u653b\u51fb2021\u5e7410\u6708",children:"Cream Finance \u653b\u51fb\uff082021\u5e7410\u6708\uff09"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u635f\u5931"}),"\uff1a1.3 \u4ebf\u7f8e\u5143"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u653b\u51fb\u624b\u6cd5\uff1a"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u8de8\u534f\u8bae\u91cd\u5165 + \u95ea\u7535\u8d37"}),"\n",(0,r.jsx)(e.li,{children:"\u5229\u7528 yUSDVault \u7684\u4ef7\u683c\u8ba1\u7b97\u6f0f\u6d1e"}),"\n",(0,r.jsx)(e.li,{children:"\u53cd\u590d\u501f\u8d37\u653e\u5927\u653b\u51fb\u6548\u679c"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u9632\u5fa1\u7b56\u7565",children:"\u9632\u5fa1\u7b56\u7565"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4f7f\u7528\u65f6\u95f4\u52a0\u6743\u5e73\u5747\u4ef7\u683ctwap",children:"1. \u4f7f\u7528\u65f6\u95f4\u52a0\u6743\u5e73\u5747\u4ef7\u683c\uff08TWAP\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:"// Uniswap V2 TWAP \u9884\u8a00\u673a\ncontract TWAPOracle {\n    uint256 public price0CumulativeLast;\n    uint256 public price1CumulativeLast;\n    uint32 public blockTimestampLast;\n    \n    function update() external {\n        (\n            uint256 price0Cumulative,\n            uint256 price1Cumulative,\n            uint32 blockTimestamp\n        ) = UniswapV2OracleLibrary.currentCumulativePrices(pair);\n        \n        uint32 timeElapsed = blockTimestamp - blockTimestampLast;\n        \n        if (timeElapsed > PERIOD) {\n            // \u8ba1\u7b97\u65f6\u95f4\u52a0\u6743\u5e73\u5747\u4ef7\u683c\n            price0Average = (price0Cumulative - price0CumulativeLast) / timeElapsed;\n            price1Average = (price1Cumulative - price1CumulativeLast) / timeElapsed;\n            \n            price0CumulativeLast = price0Cumulative;\n            price1CumulativeLast = price1Cumulative;\n            blockTimestampLast = blockTimestamp;\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u4f7f\u7528\u591a\u4e2a\u4ef7\u683c\u6e90",children:"2. \u4f7f\u7528\u591a\u4e2a\u4ef7\u683c\u6e90"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:"contract MultiSourceOracle {\n    function getPrice() public view returns (uint256) {\n        uint256 chainlinkPrice = getChainlinkPrice();\n        uint256 uniswapPrice = getUniswapTWAP();\n        uint256 curvePrice = getCurvePrice();\n        \n        // \u53d6\u4e2d\u4f4d\u6570\u6216\u52a0\u6743\u5e73\u5747\n        return median(chainlinkPrice, uniswapPrice, curvePrice);\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u5b9e\u65bd\u4ea4\u6613\u9650\u5236",children:"3. \u5b9e\u65bd\u4ea4\u6613\u9650\u5236"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'contract ProtectedProtocol {\n    mapping(address => uint256) public lastActionBlock;\n    \n    modifier oneBlockDelay() {\n        require(\n            block.number > lastActionBlock[msg.sender],\n            "Action too frequent"\n        );\n        lastActionBlock[msg.sender] = block.number;\n        _;\n    }\n    \n    function deposit() external oneBlockDelay {\n        // \u5b58\u6b3e\u903b\u8f91\n    }\n    \n    function withdraw() external oneBlockDelay {\n        // \u63d0\u6b3e\u903b\u8f91\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u6d41\u52a8\u6027\u68c0\u67e5",children:"4. \u6d41\u52a8\u6027\u68c0\u67e5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'function checkLiquidity(address token, uint256 amount) internal view {\n    uint256 poolLiquidity = getPoolLiquidity(token);\n    require(\n        amount <= poolLiquidity * MAX_TRADE_PERCENTAGE / 100,\n        "Trade too large"\n    );\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(e.h3,{id:"\u534f\u8bae\u8bbe\u8ba1\u5c42\u9762",children:"\u534f\u8bae\u8bbe\u8ba1\u5c42\u9762"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u907f\u514d\u4f9d\u8d56\u5355\u4e00\u4ef7\u683c\u6e90"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u5b9e\u65bd\u6ed1\u70b9\u4fdd\u62a4"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u8bbe\u7f6e\u4ea4\u6613\u89c4\u6a21\u4e0a\u9650"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u4f7f\u7528 TWAP \u800c\u975e\u5373\u65f6\u4ef7\u683c"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u5b9e\u65bd\u591a\u7b7e\u6cbb\u7406\uff0c\u589e\u52a0\u65f6\u95f4\u9501"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u4ee3\u7801\u5b9e\u73b0\u5c42\u9762",children:"\u4ee3\u7801\u5b9e\u73b0\u5c42\u9762"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'// \u7efc\u5408\u9632\u62a4\u793a\u4f8b\ncontract SecureDeFiProtocol {\n    using SafeMath for uint256;\n    \n    // \u4ef7\u683c\u504f\u5dee\u9608\u503c\n    uint256 constant MAX_PRICE_DEVIATION = 5; // 5%\n    \n    // \u5355\u7b14\u4ea4\u6613\u4e0a\u9650\n    uint256 constant MAX_TRADE_SIZE = 1000000 * 1e18;\n    \n    function swap(\n        address tokenIn,\n        address tokenOut,\n        uint256 amountIn\n    ) external {\n        // 1. \u68c0\u67e5\u4ea4\u6613\u89c4\u6a21\n        require(amountIn <= MAX_TRADE_SIZE, "Trade too large");\n        \n        // 2. \u83b7\u53d6\u591a\u4e2a\u4ef7\u683c\u6e90\n        uint256 twapPrice = getTWAPPrice(tokenIn, tokenOut);\n        uint256 spotPrice = getSpotPrice(tokenIn, tokenOut);\n        uint256 chainlinkPrice = getChainlinkPrice(tokenIn, tokenOut);\n        \n        // 3. \u9a8c\u8bc1\u4ef7\u683c\u504f\u5dee\n        require(\n            isPriceValid(twapPrice, spotPrice, chainlinkPrice),\n            "Price manipulation detected"\n        );\n        \n        // 4. \u6267\u884c\u4ea4\u6613\n        _executeSwap(tokenIn, tokenOut, amountIn);\n    }\n    \n    function isPriceValid(\n        uint256 price1,\n        uint256 price2,\n        uint256 price3\n    ) internal pure returns (bool) {\n        uint256 avgPrice = (price1 + price2 + price3) / 3;\n        \n        return (\n            isWithinDeviation(price1, avgPrice) &&\n            isWithinDeviation(price2, avgPrice) &&\n            isWithinDeviation(price3, avgPrice)\n        );\n    }\n    \n    function isWithinDeviation(\n        uint256 price,\n        uint256 reference\n    ) internal pure returns (bool) {\n        uint256 deviation = price > reference\n            ? (price - reference) * 100 / reference\n            : (reference - price) * 100 / reference;\n            \n        return deviation <= MAX_PRICE_DEVIATION;\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u76d1\u63a7\u4e0e\u54cd\u5e94",children:"\u76d1\u63a7\u4e0e\u54cd\u5e94"}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9e\u65f6\u76d1\u63a7\u6307\u6807",children:"\u5b9e\u65f6\u76d1\u63a7\u6307\u6807"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5f02\u5e38\u4ea4\u6613\u91cf"}),"\uff1a\u5355\u7b14\u4ea4\u6613\u8d85\u8fc7\u6c60\u5b50\u6d41\u52a8\u6027\u7684 10%"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4ef7\u683c\u5267\u70c8\u6ce2\u52a8"}),"\uff1a\u77ed\u65f6\u95f4\u5185\u4ef7\u683c\u53d8\u5316\u8d85\u8fc7 5%"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5feb\u901f\u501f\u8d37"}),"\uff1a\u540c\u4e00\u5730\u5740\u5728\u4e00\u4e2a\u533a\u5757\u5185\u591a\u6b21\u501f\u8d37"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6cbb\u7406\u5f02\u5e38"}),"\uff1a\u7a81\u7136\u51fa\u73b0\u7684\u5927\u989d\u6295\u7968"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u5e94\u6025\u54cd\u5e94\u673a\u5236",children:"\u5e94\u6025\u54cd\u5e94\u673a\u5236"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'contract EmergencyProtection {\n    address public guardian;\n    bool public paused;\n    \n    modifier whenNotPaused() {\n        require(!paused, "Protocol paused");\n        _;\n    }\n    \n    function pause() external {\n        require(msg.sender == guardian, "Not guardian");\n        paused = true;\n        emit Paused(block.timestamp);\n    }\n    \n    function unpause() external {\n        require(msg.sender == guardian, "Not guardian");\n        paused = false;\n        emit Unpaused(block.timestamp);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsx)(e.p,{children:"\u95ea\u7535\u8d37\u653b\u51fb\u662f DeFi \u5b89\u5168\u7684\u91cd\u5927\u6311\u6218\uff0c\u4f46\u901a\u8fc7\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\ud83d\udd0d ",(0,r.jsx)(e.strong,{children:"\u5ba1\u614e\u7684\u534f\u8bae\u8bbe\u8ba1"})]}),"\n",(0,r.jsxs)(e.li,{children:["\ud83d\udee1\ufe0f ",(0,r.jsx)(e.strong,{children:"\u591a\u5c42\u9632\u5fa1\u673a\u5236"})]}),"\n",(0,r.jsxs)(e.li,{children:["\ud83d\udcca ",(0,r.jsx)(e.strong,{children:"\u5b9e\u65f6\u76d1\u63a7\u7cfb\u7edf"})]}),"\n",(0,r.jsxs)(e.li,{children:["\u26a1 ",(0,r.jsx)(e.strong,{children:"\u5feb\u901f\u54cd\u5e94\u80fd\u529b"})]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4eec\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u653b\u51fb\u98ce\u9669\u3002\u8bb0\u4f4f\uff1a",(0,r.jsx)(e.strong,{children:"\u5b89\u5168\u4e0d\u662f\u4e00\u6b21\u6027\u7684\u5de5\u4f5c\uff0c\u800c\u662f\u6301\u7eed\u7684\u8fc7\u7a0b"}),"\u3002"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"AutoSec \u63d0\u793a"}),"\uff1a\u5728\u90e8\u7f72\u4efb\u4f55 DeFi \u534f\u8bae\u524d\uff0c\u52a1\u5fc5\u8fdb\u884c\u5168\u9762\u7684\u5b89\u5168\u5ba1\u8ba1\u548c\u538b\u529b\u6d4b\u8bd5\u3002"]})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},8453(n,e,i){i.d(e,{R:()=>s,x:()=>a});var l=i(6540);const r={},t=l.createContext(r);function s(n){const e=l.useContext(t);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),l.createElement(t.Provider,{value:e},n.children)}},3221(n){n.exports=JSON.parse('{"permalink":"/defi-flash-loan-attacks","editUrl":"https://github.com/pfyangf/pfyangf.github.io/tree/main/blog/2025/02-04-defi-flash-loan-attacks.md","source":"@site/blog/2025/02-04-defi-flash-loan-attacks.md","title":"DeFi\u95ea\u7535\u8d37\u653b\u51fb\u6df1\u5ea6\u5256\u6790\uff1a\u539f\u7406\u3001\u6848\u4f8b\u4e0e\u9632\u5fa1","description":"\u95ea\u7535\u8d37\uff08Flash Loan\uff09\u662f DeFi \u9886\u57df\u7684\u521b\u65b0\u91d1\u878d\u5de5\u5177\uff0c\u4f46\u540c\u65f6\u4e5f\u6210\u4e3a\u4e86\u653b\u51fb\u8005\u6700\u559c\u7231\u7684\u6b66\u5668\u30022020-2023\u5e74\u95f4\uff0c\u57fa\u4e8e\u95ea\u7535\u8d37\u7684\u653b\u51fb\u9020\u6210\u4e86\u8d85\u8fc7 10 \u4ebf\u7f8e\u5143\u7684\u635f\u5931\u3002","date":"2025-02-04T00:00:00.000Z","tags":[{"inline":true,"label":"DeFi\u5b89\u5168","permalink":"/tags/de-fi\u5b89\u5168"},{"inline":true,"label":"\u95ea\u7535\u8d37","permalink":"/tags/\u95ea\u7535\u8d37"},{"inline":true,"label":"\u4ef7\u683c\u64cd\u7eb5","permalink":"/tags/\u4ef7\u683c\u64cd\u7eb5"},{"inline":true,"label":"\u5957\u5229\u653b\u51fb","permalink":"/tags/\u5957\u5229\u653b\u51fb"},{"inline":true,"label":"\u533a\u5757\u94fe\u5b89\u5168","permalink":"/tags/\u533a\u5757\u94fe\u5b89\u5168"}],"readingTime":4.87,"hasTruncateMarker":true,"authors":[{"name":"AutoSec Team","title":"Web3 Security Researchers","url":"https://autosec.dev","imageURL":"/img/autosec.logo.png","key":"autosec","page":null}],"frontMatter":{"slug":"defi-flash-loan-attacks","title":"DeFi\u95ea\u7535\u8d37\u653b\u51fb\u6df1\u5ea6\u5256\u6790\uff1a\u539f\u7406\u3001\u6848\u4f8b\u4e0e\u9632\u5fa1","authors":["autosec"],"tags":["DeFi\u5b89\u5168","\u95ea\u7535\u8d37","\u4ef7\u683c\u64cd\u7eb5","\u5957\u5229\u653b\u51fb","\u533a\u5757\u94fe\u5b89\u5168"]},"unlisted":false,"prevItem":{"title":"\u6df1\u5ea6\u89e3\u6790\uff1a\u91cd\u5165\u653b\u51fb\u53ca\u5176\u9632\u5fa1\u7b56\u7565","permalink":"/reentrancy-attack-analysis"},"nextItem":{"title":"Cross-Chain Bridge Security: Vulnerabilities and Best Practices","permalink":"/cross-chain-bridge-security"}}')}}]);